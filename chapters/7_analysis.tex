\chapter{Analysis of impedance}
\minitoc

\section{Parametric models}
Once the impedance is measured, one can attempt to identify its dynamic fitting a physical or non-physical mathematical model (parametric). The work presented later in this work use one type or the other. The physical models where all taken from the literature. We used a model for ion adsorbtin on nanoparticle to analyse the measurement of electrical double layer capacitors and we adapted a model for intercalation with porous electrode theory both developed inside the group in the previous years. The core measurement of this work was made on lithium-ion cells, that is not the classic analytical cell with reference electrode commonly emplyed by electrochemists. The absence of the reference electrode makes cumbersome to develop a physically derived model so we decided to take the route of black-box model. Compared to the time-domain characterization where plenty of black-box models exist for any type of systems (ARMA, ARIMA, NARMAX, ecc.), the frequency-domain characterization lacks such variety and standardization, especially for time-varying systems. The approach in our group is to estimate the instantaneous impedance at quasi-stationary points using the dynamic multi-frequency analysis, hence treating the system as linear and time-invariant. Therefore the approach is to fit a generic rational function of order n infering the correct structure of the transfer function of the system though statistical methods. 

\subsection{Physical model}

\subsection{Transfer function model}


\section{Simultaneous fitting}

The approach of fitting for dynamic impedance is similar to what is commonly done for static impedance, but there is the challenge that for a non-stationary experiment the dynamic of the system can change with the activation or deactivation of chemical processes with time, voltage or temperature. For example, a battery would change its state of charge during a galvanostatic technique and the system response might change at different potential, and with its cycling history.  The common approach, sometimes called batch fitting, would be of fitting one spectra of the time using the optimized parameters of the previous spectra for the following. The problem is that some parameter of the model would be close to zero in some part of the dataset and potentially very big in others. Solving optimization problems with small and redundant parameters might lead to local solutions. Furthermore, when more than one parameter is of this type, the solver might converge to different minimum for each spectra even when the optimized parameters of the prevoious spectra are used as starting points. This issue can be addressed minimizing the entire dataset at ones and introducing a regularization term in the objective function as firstly introduced by Battistel et al. The objective function become: \\

equation?\\

Intuitively, one can consider a term that minimizes the distance between data points and model while another term keeps the parameters slowly evolving across the dataset. The penalty term avoids sudden variation of parameters that arises in those areas of the dataset where there is unavoidable overparametrization.
Recently Cuckwu extended the concept of  penalized objective function implementing modern methods to solve high dimensional optimization problem as used in the field of Machine Learning. An improvement in computation time for big dataset has been obtained combining the efficient methods for calculating derivatives called "automatic gradient" or automatic differentiation and the solver ADAM. Both can be find in the open source package JAX that uses the Python pre-compiling from the jit library to perform the calculation in multiple threads, processors or even distributed computing (including GPUs). JAX is supported for optimization-specific problems in the open source package Optax. Cuckwu implementation is open source but compatible up to Python 3.9 and only with JAXopt, the previous project from which Optax derived (not in development anymore). Dr. Nicol√≥ Pianta updated Chucwu's code base to modern version and added a convenient object rapresentation for the model function, similar to the well-enstablished python library for non linear fitting nlfit. For each experiment of the Applications part I will specify which library was used to analyze the impedance.\\

\subsection{Fitting error}
We estimate the standard deviation from the Jacobian of the objective function. The error allows to verify in most of the cases the accuracy of the model and which parameters are not significant in the estimation.

\section{Determination of the system degrees of freedom}

When fitting physical models, the user decides \emph{a priori} the degreese of freedom of the system though the number and types of approximation and the equation that chose to keep. The process of model regression gives to the scientist a confirmation that the model can represent the nature of the system under the operating condition or not. On negative result one keeps modifying the model until satisfied. On the other hand, when working with black-box model the scientist makes the opposite: identifies the degreese of freadom of the system and then look for a proper gray-box or white-box model of the same structure to undenstand the physics of the system.  This data driven apporach relies on the fact that the frequency reponse function is a numerical realization of the real transfer function of the system inside the frequency band of the experiment. From dynamic system theory it is known that the number of parameters of the transfer function is equal to the number of variables in the state space model, directly connected to the differential equations that define the system. For batteries, that works as two-electrode devices, the response of the single electrode is superimposed making even harder to define a general physical model. Usually the model are largely over-parametrized. Knowing the correct transfer function, leads scientists to chose proper approximation when developing physical model or can be is as it for prediction or classification of the system in control engeneering. It immediatly come to mind the possibililty of using it for smart control of the battery in battery managment systems. 

\section{Determining transfer function structure}
The identification of the transfer function structure is the process of finding the order of the nominator and denominator of the polynomial rational function through statistical approach. In this work I ... 